{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link rel="stylesheet" href="{% static 'Users/home.css' %}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/simple-keyboard@latest/build/css/index.css">
</head>
<body>
    <header>
        <div class="welcome">
            Welcome, <span>{{ user_name }}</span>
        </div>
        <div class="notifications" >
            <a class="notifications" href="{% url 'Users:show_friend_requests' %}">📨 Friend Requests</a>
        </div>
    </header>

    <nav>
        <ul>
            <li><a href="{% url 'Users:home' %}">Home</a></li>
            <li><a href="{% url 'Users:settings' %}">Settings</a></li>
            <li><a href="{% url 'Users:logout' %}">🚪 Logout</a></li>
        </ul>
    </nav>

    <main>
        <div class="dashboard">
            <h2>Dashboard</h2>
            <div class="buttons">
                <a href="{% url 'Users:search_users' %}" class="btn">🔍 Search Users</a>
                <a href="{% url 'Users:messages' %}" class="btn">💬 Your 1:1 Messages</a>
                <a href="{% url 'Users:show_groups' %}" class="btn">💬 Group Messages</a>
                <a href="{% url 'MarketPlace:listings' %}" class="btn">🛒 Marketplace</a>
            </div>
        </div>
    </main>

    {% if messages %}
        <div class="messages">
            {% for message in messages %}
                <div {% if message.tags %} class="{{ message.tags }}" {% endif %}>
                    {{ message }}
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <footer>
        <p>Team: 404s</p>
    </footer>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const USER_PRIVATE_KEY =  "{{ private_key|default:''|escapejs }}";
            const username = "{{ user_name|escapejs }}"
            if (!USER_PRIVATE_KEY) {
                return;
            } else {
                localStorage.setItem(username+"private_key", USER_PRIVATE_KEY);
                alert(`Keep The Downloaded File: ${username}_private.txt In A Secure Storage.`)
                const filename = `${username}_private.txt`;
                const blob = new Blob([USER_PRIVATE_KEY], { type: "text/plain" });

                const a = document.createElement("a");
                a.href = URL.createObjectURL(blob);
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);

            }
            
        });

        setTimeout(function() {
            document.querySelector('.messages').style.display = 'none';
        }, 3000);
        
    </script>
</body>
</html>
